sudo: true
dist: xenial

git:
  quiet: true

env:
  global:
    - ICARUS_VERILOG_VERSION=10_2
    - MAKE_JOBS=2 # travis-ci only provides 2

cache:
  - pip
  - directories:
    # Used by the osx builds
    - $HOME/.pyenv_cache

matrix:
  include:
    - os: osx
      language: generic
      env: PYENV_VERSION=2.7.15
    - os: osx
      language: generic
      env: PYENV_VERSION=3.5.6
    - os: osx
      language: generic
      env: PYENV_VERSION=3.6.7
    - os: linux
      dist: trusty
      language: python
      python: 2.6
      # flake8 does not support Python 2.6 since v3.0
      # (http://flake8.pycqa.org/en/latest/release-notes/3.0.0.html)
      env: NO_FLAKE8=1
    - os: linux
      language: python
      python: 2.7
    - os: linux
      language: python
      python: 3.4
    - os: linux
      language: python
      python: 3.5
    - os: linux
      language: python
      python: 3.6
    - os: linux
      language: python
      python: 3.7

install:
  # The install.sh script is sourced to retain environment variables set there!
  - . ./.travis/install.sh
  # Ensure that whatever the install.sh script does we're back in our build dir
  - cd $TRAVIS_BUILD_DIR

script:
  - [ -z "$NO_FLAKE8" ] && flake8 --exit-zero cocotb/
  - tox
