sudo: true
dist: xenial

git:
  quiet: true

env:
  global:
    - LINUX_ICARUS_VERILOG_VERSION=10_2

cache:
  - pip
  # Caching on pyenv on osx leads to broken builds with libpython*.so.a not
  # not found.
  #- directories:
  #  # Used by the osx builds
  #  - $HOME/.pyenv_cache

matrix:
  include:
    - os: windows
      language: cpp
      services:
        - docker

    - os: osx
      language: generic
      env: TRAVIS_PYTHON_VERSION=2.7.15
    - os: osx
      language: generic
      env: TRAVIS_PYTHON_VERSION=3.4.9
    - os: osx
      language: generic
      env: TRAVIS_PYTHON_VERSION=3.5.6
    - os: osx
      language: generic
      env: TRAVIS_PYTHON_VERSION=3.6.7
    - os: osx
      language: generic
      env: TRAVIS_PYTHON_VERSION=3.7.1

    - os: linux
      language: python
      python: 2.7
    - os: linux
      language: python
      python: 3.4
    - os: linux
      language: python
      python: 3.5
    - os: linux
      language: python
      python: 3.6
    - os: linux
      language: python
      python: 3.7

install:
  # The install.sh script is sourced to retain environment variables set there!
  - if [ "$TRAVIS_OS_NAME" != "windows" ]; then source ./.travis/install.sh; fi

script:
  - if [ "$TRAVIS_OS_NAME" != "windows" ]; then flake8 --exit-zero cocotb/; fi
  - if [ "$TRAVIS_OS_NAME" != "windows" ]; then tox; fi

  - if [ "$TRAVIS_OS_NAME" == "windows" ]; then docker build -f .travis/Dockerfile.windows . ; fi
