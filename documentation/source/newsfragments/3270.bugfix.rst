Fixed cleanup in scheduler which caused sporadic warning messages and bugs in some corner cases.
